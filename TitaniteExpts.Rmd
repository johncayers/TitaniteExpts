---
title: "Titanite solubility experiments: Analysis of EDS data"
output: html_notebook
---

```{r}
library(tidyverse, warn.conflicts = FALSE)
# Import normalized EDS glass analyses
TitaniteExpts <- read_csv("TitaniteExpts.csv")
```
```{r}
TitaniteCations <- TitaniteExpts %>%
  mutate(
    Si = SiO2/60.0848,
    Al = 2*Al2O3/101.961,
    Na = 2*Na2O/61.979,
    K = 2*K2O/94.194,
    Ca = CaO/56.0794,
    Fe = FeO/71.8464,
    Mg = MgO/40.3044,
    Ti = TiO2/79.8988,
    Mn = MnO/70.9374,
    P = 2*P2O5/141.945,
    eCa = (CaO/56.0794 - Al2O3/101.961 + K2O/94.194 + Na2O/61.979),
    CationSum = (Si + Al + Na + K + Ca + Fe + Mg + Ti + Mn + P)
             )
```

Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Ctrl+Alt+I*.
```{r}
# Calculate cation fractions
CationFractions <- select(TitaniteCations, Model, Expt, TC, TiO2, Si:eCa, CationSum)
f <- match("Si", names(CationFractions))
l <- match("eCa", names(CationFractions))
for (i in f:l) {
  CationFractions[(i)] = CationFractions[(i)]/CationFractions$CationSum
}

```


```{r}
# Calculate melt composition parameters
CationFractions <- CationFractions %>%
  mutate(
    M = (Na + K + 2*Ca)/(Si*Al),
    FM = (Na + K + 2*(Ca + Fe + Mg))/(Si*Al),
    C = (10*eCa)/(Si*Al),
    InvTK = 1/(TC+273.15)
    )
```


```{r}
# Scatterplot matrices
library(car)
scatterplotMatrix(~ Ti + Ca + Al + InvTK + M + FM + C, data = CationFractions, groups = CationFractions$Model, smooth = FALSE)
# Correlation matrix
CorrTest <- select(CationFractions, TiO2, M:InvTK)
cor(CorrTest)
# Glass TiO2 concentration is most highly correlated with melt composition parameter C.

```

```{r}
fit <- lm(TiO2 ~ C + InvTK, data = CationFractions)
summary(fit)
plot(fit)

```

```{r}
# Experiments 29, 30 & 31 are identified as outliers. They were Danny's earliest experiments, and were all run at 1300C.

RegModel <- select(CationFractions, Model, Expt, TiO2, InvTK, C)
RegModel <- slice(RegModel, -(29:31))
fit <- lm(TiO2 ~ C + InvTK, data = RegModel)
summary(fit)
plot(fit)

```

```{r}
# Try filtering out experiments with Model = "N"
RegModel <- select(CationFractions, Model, Expt, TiO2, InvTK, C)
RegModel <- filter(RegModel, Model == "Y")
fit <- lm(TiO2 ~ C + InvTK, data = RegModel)
summary(fit)
plot(fit)
# 6 fewer experiments increases r^2 to 0.98
```


```

```{r}
# Use leaps package for regular subsets regression
library(leaps)
leaps <- regsubsets(TiO2 ~ InvTK + M + FM + C, data = CationFractions, nbest = 2)
plot(leaps, scale = "adjr2")
